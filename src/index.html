<!DOCTYPE HTML>
<html>
    <head>
        <meta charset="UTF-8">
        <title>A Moxie Mixtape!</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" type="text/css" href="moxie.css" />
        <script type="text/javascript" src="moxie.js"></script>
    </head>
    <body>
        <script>
            var app = Elm.Moxie.fullscreen();

            app.ports.title.subscribe(function(title) {
                document.title = title;
            });

            each = function(arr, fn) {
                for (var i = 0; i < arr.length; i++) {
                    fn(arr[i], i);
                }
            };

            app.ports.play.subscribe(function(index) {
                each(document.querySelectorAll('audio'), function(audio, i) {
                    if (i == index) {
                        audio.addEventListener('canplay', function() {
                            audio.play();
                        }, {once: true});

                        audio.load();
                    } else {
                        audio.pause();
                    }
                });
            });

            app.ports.pause.subscribe(function() {
                each(document.querySelectorAll('audio'), function(audio) {
                    audio.pause();
                });
            });

            app.ports.resume.subscribe(function(index) {
                each(document.querySelectorAll('audio'), function(audio, i) {
                    if (i == index) {
                        audio.play();
                    } else {
                        audio.pause();
                    }
                });
            });
        </script>
    </body>
</html>
